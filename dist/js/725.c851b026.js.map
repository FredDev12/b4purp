{"version":3,"file":"js/725.c851b026.js","mappings":"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","sources":["webpack://frontend/./src/components/InputField.vue","webpack://frontend/./src/components/InputField.vue?e0ec","webpack://frontend/./src/views/Login.vue","webpack://frontend/./src/views/Login.vue?240b","webpack://frontend/./src/store/Storage.js"],"sourcesContent":["<template>\r\n  <div class=\"input-field\">\r\n    <label v-if=\"label\" :for=\"id\" class=\"input-label\">{{ label }}</label>\r\n    <input\r\n      :id=\"id\"\r\n      :type=\"type\"\r\n      :value=\"modelValue\"\r\n      :placeholder=\"placeholder\"\r\n      :disabled=\"disabled\"\r\n      :maxlength=\"maxlength\"\r\n      :minlength=\"minlength\"\r\n      @input=\"$emit('update:modelValue', ($event.target).value)\"\r\n      class=\"input\"\r\n    />\r\n    <p v-if=\"errorMessage\" class=\"error-message\">{{ errorMessage }}</p>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { defineComponent } from 'vue';\r\n\r\nexport default defineComponent({\r\n  name: 'InputField',\r\n  props: {\r\n    id: {\r\n      type: String,\r\n      required: true,\r\n      \r\n    },\r\n    label: {\r\n      type: String,\r\n      required: true,\r\n      \r\n    },\r\n    type: {\r\n      type: String,\r\n      default: 'text',\r\n    },\r\n    modelValue: {\r\n      type: String,\r\n      required: true,\r\n    },\r\n    placeholder: {\r\n      type: String,\r\n      required: true,\r\n      \r\n    },\r\n    disabled: {\r\n      type: Boolean,\r\n      required: false,\r\n      default: false,\r\n    },\r\n    maxlength: {\r\n      type: Number,\r\n      required: false,\r\n    },\r\n    minlength: {\r\n      type: Number,\r\n      required: false,\r\n    },\r\n    errorMessage: {\r\n      type: String,\r\n      required: false,\r\n      \r\n    },\r\n  },\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n.input-field {\r\n  display: flex;\r\n  flex-direction: column;\r\n  margin-bottom: 16px;\r\n}\r\n\r\n.input-label {\r\n  margin-bottom: 8px;\r\n  font-weight: bold;\r\n}\r\n\r\n.input {\r\n  padding: 8px;\r\n  border: 1px solid #ccc;\r\n  border-radius: 4px;\r\n  font-size: 16px;\r\n}\r\n\r\n.input:focus {\r\n  border-color: #007bff;\r\n  outline: none;\r\n}\r\n\r\n.error-message {\r\n  color: red;\r\n  font-size: 14px;\r\n  margin-top: 4px;\r\n}\r\n</style>\r\n","import { render } from \"./InputField.vue?vue&type=template&id=493aa504&scoped=true\"\nimport script from \"./InputField.vue?vue&type=script&lang=js\"\nexport * from \"./InputField.vue?vue&type=script&lang=js\"\n\nimport \"./InputField.vue?vue&type=style&index=0&id=493aa504&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-493aa504\"]])\n\nexport default __exports__","<template>\r\n    <div class=\"login-container\">\r\n      <!-- Logo Section -->\r\n      <img src=\"../assets/wadoria.png\" alt=\"Logo\" class=\"logo\" />\r\n\r\n      <h1>Connexion</h1>\r\n      <form @submit.prevent=\"handleLogin\">\r\n        <div class=\"form-group\">\r\n          \r\n          <InputField type=\"email\" id=\"email\" v-model=\"email\" label=\"Email\" :error-message=\"emailError\" placeholder=\"Entrez votre email\" required />\r\n                 \r\n          <InputField type=\"password\" id=\"password\" v-model=\"password\" label=\"Mot de passe\" :error-message=\"passwordError\" placeholder=\"Entrez votre mot de passe\" required />\r\n          \r\n        </div>\r\n        <ButtonComponent\r\n            type=\"submit\"\r\n            class=\"btn-primary\"\r\n            :disabled=\"loading\"\r\n        >\r\n            <template v-if=\"loading\">Chargement...</template>\r\n            <template v-else>Se connecter</template>\r\n        </ButtonComponent>\r\n        <p v-if=\"apiError\" class=\"error\">{{ apiError }}</p>\r\n      </form>\r\n      <p>\r\n        <router-link to=\"/requestPasswordReset\">Mot de passe oublié ?</router-link>\r\n      </p>\r\n    </div>\r\n  </template>\r\n  \r\n  <script>\r\n  import { defineComponent, ref, reactive } from \"vue\";\r\n  import { useRouter } from \"vue-router\";  \r\n  import { useStore } from '../store/Storage';\r\n  import ButtonComponent from '../components/ButtonComponent.vue';\r\n  import InputField from '../components/InputField.vue';\r\n  \r\n\r\n  export default defineComponent({\r\n    name: \"Login\",\r\n    components: {\r\n      ButtonComponent,\r\n      InputField,\r\n    },\r\n    setup() {\r\n      const router = useRouter();\r\n      const authStore = useStore();     \r\n      const email = ref('');\r\n      const password = ref('');\r\n      const emailError = ref(\"\");\r\n      const passwordError = ref(\"\");\r\n      const apiError = ref(\"\");\r\n      const loading = ref(false);\r\n  \r\n      const handleLogin = async () => {\r\n        loading.value = true;\r\n        // Réinitialiser les erreurs\r\n        emailError.value = \"\";\r\n        passwordError.value = \"\";\r\n        apiError.value = \"\";\r\n\r\n        // Valider l'email\r\n        if (!validateEmail(email.value)) {\r\n            emailError.value = \"Veuillez entrer une adresse email valide.\";\r\n            loading.value = false;\r\n            return;\r\n        }\r\n        // Valider le mot de passe\r\n        if (password.value.length < 6) {\r\n            passwordError.value = \"Le mot de passe doit contenir au moins 6 caractères.\";\r\n            loading.value = false;\r\n            return;\r\n        }\r\n        \r\n        try {  \r\n          await authStore.performLogin(email.value, password.value);\r\n                  \r\n          router.push({ name: 'Dashboard' });                    \r\n          \r\n        } catch (error) {\r\n          console.error(error);          \r\n          apiError.value = (error).message || \"Role non reconnu.\";          \r\n        } finally {\r\n          loading.value = false;\r\n        }\r\n      };\r\n\r\n      const validateEmail = (email) => {\r\n            const re = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/;\r\n            return re.test(email);\r\n        };\r\n  \r\n      return { email, password, emailError, passwordError, apiError, handleLogin, loading };\r\n    },\r\n  });\r\n  </script>","import { render } from \"./Login.vue?vue&type=template&id=7faf4e8c\"\nimport script from \"./Login.vue?vue&type=script&lang=js\"\nexport * from \"./Login.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","// src/store/authStore.ts\r\nimport { defineStore } from 'pinia';\r\nimport { login, register, getUserProfile, logoutUser, listUsers, getUsers, getContract } from '../api/serviceAPI';\r\n\r\n\r\nexport const useStore = defineStore({\r\n  id: 'auth',\r\n  state: () => ({\r\n    token: localStorage.getItem('token') || null,\r\n    userProfile: null,\r\n    users: [],\r\n    userList:[],\r\n    listContract: [],\r\n    listClients: [],\r\n    listManagers: [],\r\n    listUtilisateurs: [],\r\n    isAuthenticated: !!localStorage.getItem('token'),\r\n  }),\r\n  actions: {\r\n    async performLogin(email, password) {\r\n      try {\r\n        const response = await login(email, password);\r\n        const token = response.token\r\n        const role = response.role\r\n        const userId = response.id\r\n        this.token = token;\r\n        localStorage.setItem('token', token);\r\n        localStorage.setItem('role', role);\r\n        localStorage.setItem('id', userId);\r\n        this.isAuthenticated = true;\r\n        // Fetch user profile upon successful login\r\n        await this.fetchUserProfile(token);\r\n        await this.fetchUsers(role ,token);\r\n        await this.fetchContract(role, token);\r\n      } catch (error) {\r\n        console.error('Authentication failed:', error);\r\n        throw new Error('Login failed');\r\n      }\r\n    },\r\n\r\n    async fetchUserProfile(token) {\r\n      if (!token) {\r\n        console.error('No token provided');\r\n        return;\r\n      }\r\n      try {\r\n        const response = await getUserProfile(token);\r\n        this.userProfile = response;\r\n        this.isAuthenticated = true;\r\n      } catch (error) {\r\n        console.error('Failed to fetch user profile:', error);\r\n        this.isAuthenticated = false;\r\n      }\r\n    },\r\n\r\n    async fetchUsers(role, token){\r\n      if (!token) {\r\n        console.error('No token provided');\r\n        return;\r\n      }\r\n      try {\r\n        const response = await listUsers(role, token);\r\n        console.log('storage', response);\r\n        \r\n        this.users = response;\r\n\r\n        console.log(this.users);\r\n        \r\n        this.isAuthenticated = true;\r\n      } catch (error) {\r\n        console.error('Failed to fetch user:', error);\r\n        this.isAuthenticated = false;\r\n      }\r\n\r\n    },\r\n\r\n    async fetchUsersBY(role, token){\r\n      if (!token) {\r\n        console.error('No token provided');\r\n        return;\r\n      }\r\n      try {\r\n        const response = await getUsers(role, token);\r\n        console.log('storage', response);\r\n        \r\n        this.userList = response;\r\n\r\n        console.log('liste ',this.userList);\r\n        \r\n        //this.isAuthenticated = true;\r\n      } catch (error) {\r\n        console.error('Failed to fetch user:', error);\r\n        this.isAuthenticated = false;\r\n      }\r\n\r\n    },\r\n\r\n    async fetchContract(role, token){\r\n      if (!token) {\r\n        console.error('No token provided');\r\n        return;\r\n      }\r\n      try {\r\n        const response = await getContract(role, token);\r\n        console.log('storage', response);\r\n        \r\n        this.listContract = response;\r\n\r\n        console.log('liste ',this.listContract);\r\n        \r\n        //this.isAuthenticated = true;\r\n      } catch (error) {\r\n        console.error('Failed to fetch user:', error);\r\n        this.isAuthenticated = false;\r\n      }\r\n\r\n    },\r\n    \r\n    async performLogout() {\r\n      if (!this.token) {\r\n        console.error('No token provided');\r\n        return;\r\n      }\r\n      try {\r\n        await logoutUser(this.token);\r\n        this.isAuthenticated = false;\r\n        this.userProfile = null;\r\n        localStorage.removeItem(\"token\");\r\n        localStorage.removeItem(\"role\");\r\n        localStorage.removeItem(\"id\");\r\n      } catch (error) {\r\n        console.error('Failed to logout:', error);\r\n      }\r\n    },\r\n\r\n    async addUser(payload){\r\n\r\n    },\r\n\r\n    async fetchUsersByRole(role) {\r\n      if (!this.token) {\r\n        console.error('No token provided');\r\n        return;\r\n      }\r\n      try {\r\n        const users = await listUsers( role, this.token);\r\n        if (role === 'client') {\r\n          this.listClients = users;\r\n        } else if (role === 'manager') {\r\n          this.listManagers = users;\r\n        } else {\r\n          this.listUtilisateurs = users;\r\n        }\r\n      } catch (error) {\r\n        console.error(`Failed to fetch ${role}s:`, error);\r\n      }\r\n    }\r\n  },\r\n});\r\n"],"names":["class","label","for","id","type","value","modelValue","placeholder","disabled","maxlength","minlength","$emit","$event","errorMessage","name","props","String","required","default","Boolean","Number","__exports__","render","src","alt","handleLogin","email","emailError","password","passwordError","loading","apiError","to","components","ButtonComponent","InputField","setup","router","authStore","async","validateEmail","length","performLogin","push","error","console","message","re","test","useStore","state","token","localStorage","getItem","userProfile","users","userList","listContract","listClients","listManagers","listUtilisateurs","isAuthenticated","actions","response","role","userId","this","setItem","fetchUserProfile","fetchUsers","fetchContract","Error","log","fetchUsersBY","performLogout","removeItem","addUser","payload","fetchUsersByRole"],"sourceRoot":""}